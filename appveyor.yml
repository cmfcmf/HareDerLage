version: 1.0.{build}

os: unstable

branches:
  only:
    - master
    - ci-appveyor # TODO: remove

clone_folder: c:\game

environment:
  APPVEYOR_RDP_PASSWORD: game

# https://www.appveyor.com/docs/how-to/rdp-to-build-worker/
init:
  - ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))

before_build:
  - cmd: mkdir c:\game-build
  - cmd: mkdir c:\tmp
  - cmd: cd c:\tmp
  - ps: Start-FileDownload 'https://downloads.tuxfamily.org/godotengine/3.0.2/Godot_v3.0.2-stable_win64.exe.zip'
  - cmd: 7z x Godot_v3.0.2-stable_win64.exe.zip
  - ps: mv Godot_v3.0.2-stable_win64.exe godot.exe

build_script:
  - cmd: godot.exe --no-window --export 'Windows Desktop' --path c:\game c:\game-build\game.exe

artifacts:
  - path: c:\game-build

deploy:
  - provider: GitHub
    artifact:
    draft: false
    prerelease: false
    on:
      branch: master
      appveyor_repo_tag: true # deploy on tag push only
